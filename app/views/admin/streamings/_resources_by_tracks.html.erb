<div class="row">
  <div class="col-10">
    <h3>Track毎の配信用リソース一覧</h3>
  </div>
</div>

<div class="row">
  <div class="col">
    <table class="table table-striped talks_table" >
      <thead>
      <tr>
        <th scope="col">Track</th>
        <th scope="col">リソース</th>
        <th scope="col">一括作成</th>
        <th scope="col">一括削除</th>
        <th scope="col">MediaLive Channel</th>
        <th scope="col">MediaLive Channel Status</th>
      </tr>
      </thead>
      <tbody>
      <% @tracks.each do |track| %>
        <tr>
          <td>
            <%= track.name %>
          </td>
          <td>
            <% if track.streaming %>
              <%= track.streaming.status %>
            <% end %>
          </td>
          <td>
            <% if track.streaming && %w(deleted error).include?(track.streaming.status) %>
              <%= button_to("配信用リソースを一括作成", admin_create_aws_resources_path(id: track.streaming.id), {method: :post, class: "btn btn-primary"}) %>
            <% elsif track.streaming.nil? || track.streaming.status == 'deleted' %>
              <%= form_with(url: admin_streamings_path, model: Streaming.new, method: :post, local: true) do |form| %>
                <%= form.hidden_field :conference_id, value: @conference.id %>
                <%= form.hidden_field :track_id, value: track.id %>
                <%= form.hidden_field :status, value: 'creating' %>
                <%= form.submit "配信用リソースを一括作成", class: "btn btn-primary" %>
              <% end %>
            <% end %>
          </td>
          <td>
            <% if track.streaming && track.streaming.status != 'deleted' %>
              <%= button_to("配信用リソースを一括削除", admin_delete_aws_resources_path(id: track.streaming.id), {method: :post, class: "btn btn-primary"}) %>
            <% end %>
          </td>
          <td>
            <% if track.media_live_channel %>
              <% if track.media_live_channel.idle? %>
                <%= button_to("Start Channel", admin_start_media_live_channel_path(id: track.media_live_channel.id), {method: :post, class: "btn btn-primary"}) %>
              <% elsif track.media_live_channel.running? %>
                <%= button_to("Stop Channel", admin_stop_media_live_channel_path(id: track.media_live_channel.id), {method: :post, class: "btn btn-primary"}) %>
              <% end %>
            <% end %>
          </td>
          <td>
            <% if track.media_live_channel %>
              <%= track.media_live_channel.aws_resource&.state %>
            <% end %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>
